# Base Image
FROM node:20-slim

# Set working directory voor de gehele applicatie
WORKDIR /app

# Kopieer de volledige project-context
COPY . .

# Installeer dependencies in de correcte submap
WORKDIR /app/backend
RUN npm ci --omit=dev

# Exposeer de poort
EXPOSE 3000

# Start de applicatie met absolute paden voor maximale robuustheid
CMD ["/bin/sh", "-c", "npx knex migrate:latest --knexfile /app/backend/knexfile.cjs && node /app/backend/server.js"]